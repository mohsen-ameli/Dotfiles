#!/bin/bash
##########################
## Network connectivity information
##########################

print_usage() {
	echo -e """Usage: $0 [arguments]
	
arguments:
	--live: \t\t Prints the info for live
	--full: \t\t Shows wifi icon and strength percentage
	--icon: \t\t Shows only the wifi icon
	--info: \t\t Shows all the information
    --status: \t\t Shows the status of the connection"""
}

interface=$(ip addr | grep BROADCAST | awk '{print $2}' | cut -f1 -d:)

connected=$(nmcli device status | awk "/^$interface/ {print \$3}")

if [[ $1 == "--status" ]]; then
    echo $connected
    exit 0
fi

if [[ $connected == "disconnected" ]]; then
    if [[ $1 == "--live" ]]; then
        echo "{\"text\": \"󰤭\", \"class\": \"disconnected\", \"tooltip\": \"Disconnected\"}"
    elif [[ $1 == "--info" ]]; then
        echo "Disconnected From WiFi."
    else
        echo "󰤭"
    fi
    exit 0
fi

strength=$(awk 'NR==3 {printf("%.0f", $3*10/7)}' /proc/net/wireless)
connection=$(nmcli connection show)
essid=$(echo "$connection" | awk 'NR == 2 {print $1}')
ipaddr=$(nmcli device show $interface | awk '/^IP4.ADDRESS/ {print $2}' | cut -f1 -d/)

icon() {
    strength=$1
    if [[ $strength -ge 75 ]]; then
        icon="󰤨"
    elif [[ $strength -ge 50 ]]; then
        icon="󰤥"
    elif [[ $strength -ge 25 ]]; then
        icon="󰤢"
    else
        icon="󰤟"
    fi

    echo "$icon"
}

full() {
    strength=$1
    echo "$(icon $strength) $strength%"
}

info() {
    strength=$1
    # echo "ESSID: $essid"
    # echo "Interface: $interface"
    # echo "Strength: $strength%"
    # echo "Local IP: $ipaddr"

    echo "ESSID: $essid\n\nInterface: $interface\n\nStrength: $strength%\n\nLocal IP: $ipaddr"
}

live() {
    while true; do
        strength=$(awk 'NR==3 {printf("%.0f", $3*10/7)}' /proc/net/wireless)
        echo "{\"full\": \"$(full $strength)\", \"icon\": \"$(icon $strength)\" , \"info\": \"$(info $strength)\"}"
        sleep 5
    done
}

if [[ $1 == "--live" ]]; then
    live
elif [[ $1 == "--info" ]]; then
    info $strength
elif [[ $1 == "--icon" ]]; then
    icon $strength
elif [[ $1 == "--full" ]]; then
    full $strength
else
    print_usage
fi
