#!/bin/bash
##########################
## Get the battery capacity and its icon
##########################

print_usage() {
	echo -e """Usage: $0 [arguments]
	
arguments:
    --text: \t print battery percentage text only
    --icon: \t print battery icon only
    --text-icon: \t print both icon and percentage
    --text-icon-live: \t print both icon and percentage live
    --capacity-live: \t print battery percentage live
    --status-live: \t print battery charging status live"""
}

UPDATE_TIME=20
capacity=$(cat /sys/class/power_supply/BAT0/capacity)
status=$(cat /sys/class/power_supply/BAT0/status)

get_icon() {
    if [[ $status == "Charging" ]]; then
        icon=""
    elif [[ $capacity -lt 10 ]]; then
        icon=""
    elif [[ $capacity -lt 35 ]]; then
        icon=""
    elif [[ $capacity -lt 50 ]]; then
        icon=""
    elif [[ $capacity -lt 75 ]]; then
        icon=""
    else
        icon=""
    fi
    echo "$icon"
}

live_capacity() {
    while true; do
        capacity=$(cat /sys/class/power_supply/BAT0/capacity)
        echo "$capacity"
        sleep $UPDATE_TIME
    done
}

live_status() {
    while true; do
        capacity=$(cat /sys/class/power_supply/BAT0/capacity)
        status=$(cat /sys/class/power_supply/BAT0/status)
        if [[ $status == "Discharging" ]]; then
            if [[ $capacity -le 5 ]]; then
                echo "critical"
            elif [[ $capacity -le 15 ]]; then
                echo "low"
            elif [[ $capacity -le 25 ]]; then
                echo "warning"
            else
                echo "discharging"
            fi
        else
            echo "charging"
        fi
        sleep $UPDATE_TIME
    done
}

live_text_icon() {
    while true; do
        capacity=$(cat /sys/class/power_supply/BAT0/capacity)
        echo "$capacity% $(get_icon)"
        sleep $UPDATE_TIME
    done
}

if [[ $1 == "--text" ]]; then
    echo "$capacity"
elif [[ $1 == "--icon" ]]; then
    get_icon
elif [[ $1 == "--text-icon" ]]; then
    echo "$capacity% $(get_icon)"
elif [[ $1 == "--text-icon-live" ]]; then
    live_text_icon
elif [[ $1 == "--capacity-live" ]]; then
    live_capacity
elif [[ $1 == "--status-live" ]]; then
    live_status
else
    print_usage
fi
